Declare @af_codigo_contable varchar(25);
Declare @af_codigo_interno int;
Declare @depre_financ_anual float;
Declare @depre_financ_acumulada float;
Declare @valor_libros_financ float;
Declare @periodoEvaluado varchar(6);
Declare @periodoAnterior varchar(6);

set @periodoAnterior = '122020';
set @periodoEvaluado = '012021';

DECLARE depreciacionFinanciera cursor scroll

for

select af_codigo_interno,af_codigo_contable, depre_financ_anual, depre_financ_acumulada,
 valor_libros_financ from af_depreciacion_financiera where periodo = @periodoAnterior

open depreciacionFinanciera

fetch next from depreciacionFinanciera into
@af_codigo_interno, @af_codigo_contable, @depre_financ_anual, @depre_financ_acumulada,
@valor_libros_financ

	while (@@fetch_status = 0)
		begin
			Insert into af_depreciacion_financiera (af_codigo_interno, af_codigo_contable,
			depre_financ_anual,depre_financ_acumulada,valor_libros_financ,periodo)
			
			select af_codigo_interno = @af_codigo_interno, af_codigo_contable = @af_codigo_contable,
			depre_financ_anual = @depre_financ_anual, 
			depre_financ_acumulada = @depreciacionAnualFinanciera,
			valor_libros_financ = 0,
			periodo = @periodoEvaluado
			
			fetch next from depreciacionFinanciera into
			@af_codigo_interno, @af_codigo_contable, @depre_financ_anual, @depre_financ_acumulada,
			@valor_libros_financ
         END
    CLOSE depreciacionFinanciera
DEALLOCATE depreciacionFinanciera